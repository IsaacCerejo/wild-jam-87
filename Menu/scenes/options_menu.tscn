[gd_scene load_steps=3 format=3 uid="uid://bp7pspq4knti5"]

[ext_resource type="Theme" uid="uid://2ek7eagjo7f0" path="res://Menu/themes/general_theme.tres" id="1_7qeq7"]

[sub_resource type="GDScript" id="GDScript_xg4df"]
resource_name = "options_menu"
script/source = "extends Control

@export var close_button: Button
@export var music_volume_bar: ProgressBar
@export var sound_volume_bar: ProgressBar

var volume_steps: Array = [-100, -40, -30, -20, -15, -10, -7, -4, -2, 0]

func _ready() -> void:
	_apply_music_volume()
	_apply_sound_volume()
	
func focus():
	show()
	close_button.grab_focus()
		
func _on_fullscreen_pressed() -> void:
	var mode := DisplayServer.window_get_mode()
	
	if mode == DisplayServer.WINDOW_MODE_FULLSCREEN or mode == DisplayServer.WINDOW_MODE_EXCLUSIVE_FULLSCREEN:
		DisplayServer.window_set_mode(DisplayServer.WINDOW_MODE_WINDOWED)
	else:
		DisplayServer.window_set_mode(DisplayServer.WINDOW_MODE_FULLSCREEN)

func _on_close_pressed() -> void:
	hide()

func _apply_music_volume() -> void:
	AudioServer.set_bus_volume_db(AudioServer.get_bus_index(\"Music\"), volume_steps[Global.music_step])
	music_volume_bar.value = float(Global.music_step) / float(volume_steps.size() - 1)


func _apply_sound_volume() -> void:
	AudioServer.set_bus_volume_db(AudioServer.get_bus_index(\"SFX\"), volume_steps[Global.sound_step])
	sound_volume_bar.value = float(Global.sound_step) / float(volume_steps.size() - 1)


func _on_minus_music_button_pressed() -> void:
	Global.music_step = max(0, Global.music_step - 1)
	_apply_music_volume()


func _on_plus_music_button_pressed() -> void:
	Global.music_step = min(volume_steps.size() - 1, Global.music_step + 1)
	_apply_music_volume()


func _on_minus_sound_button_pressed() -> void:
	Global.sound_step = max(0, Global.sound_step - 1)
	_apply_sound_volume()

func _on_plus_sound_button_pressed() -> void:
	Global.sound_step = min(volume_steps.size() - 1, Global.sound_step + 1)
	_apply_sound_volume()
"

[node name="options_menu" type="Control" node_paths=PackedStringArray("close_button", "music_volume_bar", "sound_volume_bar")]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = SubResource("GDScript_xg4df")
close_button = NodePath("VBoxContainer/close")
music_volume_bar = NodePath("VBoxContainer/MusicContainer/music_volume_bar")
sound_volume_bar = NodePath("VBoxContainer/SoundContainer/sound_volume_bar")

[node name="Panel" type="Panel" parent="."]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -195.0
offset_top = -258.0
offset_right = 195.0
offset_bottom = 258.0
grow_horizontal = 2
grow_vertical = 2
theme = ExtResource("1_7qeq7")

[node name="VBoxContainer" type="VBoxContainer" parent="."]
custom_minimum_size = Vector2(310, 0)
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -95.0
offset_top = -126.0
offset_right = 95.0
offset_bottom = 144.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 8

[node name="settings_label" type="Label" parent="VBoxContainer"]
custom_minimum_size = Vector2(160, 40)
layout_mode = 2
size_flags_horizontal = 4
focus_neighbor_left = NodePath(".")
focus_neighbor_top = NodePath("../fullscreen_checkbutton")
focus_neighbor_right = NodePath(".")
focus_neighbor_bottom = NodePath("../sound_label")
focus_next = NodePath("../sound_label")
focus_previous = NodePath("../fullscreen_checkbutton")
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
theme_override_font_sizes/font_size = 20
text = "SETTINGS"
horizontal_alignment = 1
vertical_alignment = 1

[node name="blank3" type="Control" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 31.705)
layout_mode = 2

[node name="fullscreen_checkbutton" type="Button" parent="VBoxContainer"]
custom_minimum_size = Vector2(160, 40)
layout_mode = 2
size_flags_horizontal = 4
focus_mode = 0
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
text = "FULLSCREEN"

[node name="blank4" type="Control" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 12)
layout_mode = 2

[node name="music_label" type="Label" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 26)
layout_mode = 2
focus_neighbor_left = NodePath(".")
focus_neighbor_top = NodePath("../fullscreen_checkbutton")
focus_neighbor_right = NodePath(".")
focus_neighbor_bottom = NodePath("../sound_label")
focus_next = NodePath("../sound_label")
focus_previous = NodePath("../fullscreen_checkbutton")
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
text = "music & ambient"
horizontal_alignment = 1
vertical_alignment = 2

[node name="MusicContainer" type="HBoxContainer" parent="VBoxContainer"]
layout_mode = 2
theme_override_constants/separation = 10
alignment = 1

[node name="minus_music_button" type="Button" parent="VBoxContainer/MusicContainer"]
z_index = 1
custom_minimum_size = Vector2(40, 34)
layout_mode = 2
size_flags_horizontal = 6
size_flags_vertical = 8
focus_mode = 0
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
text = "-"

[node name="music_volume_bar" type="ProgressBar" parent="VBoxContainer/MusicContainer"]
custom_minimum_size = Vector2(220, 38)
layout_mode = 2
size_flags_horizontal = 4
theme = ExtResource("1_7qeq7")
max_value = 1.0
value = 0.5
show_percentage = false

[node name="plus_music_button" type="Button" parent="VBoxContainer/MusicContainer"]
custom_minimum_size = Vector2(40, 34)
layout_mode = 2
size_flags_horizontal = 6
size_flags_vertical = 8
focus_mode = 0
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
theme_type_variation = &"small button"
text = "+"
icon_alignment = 1

[node name="blank5" type="Control" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 12)
layout_mode = 2

[node name="sound_label" type="Label" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 26)
layout_mode = 2
focus_neighbor_left = NodePath(".")
focus_neighbor_top = NodePath("../music_label")
focus_neighbor_right = NodePath(".")
focus_neighbor_bottom = NodePath("../close")
focus_next = NodePath("../close")
focus_previous = NodePath("../music_label")
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
text = "sound"
horizontal_alignment = 1
vertical_alignment = 2

[node name="SoundContainer" type="HBoxContainer" parent="VBoxContainer"]
layout_mode = 2
theme_override_constants/separation = 10
alignment = 1

[node name="minus_sound_button" type="Button" parent="VBoxContainer/SoundContainer"]
z_index = 1
custom_minimum_size = Vector2(40, 34)
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 8
focus_mode = 0
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
theme_type_variation = &"small button"
text = "-"

[node name="sound_volume_bar" type="ProgressBar" parent="VBoxContainer/SoundContainer"]
custom_minimum_size = Vector2(220, 38)
layout_mode = 2
size_flags_horizontal = 4
theme = ExtResource("1_7qeq7")
max_value = 1.0
value = 0.5
show_percentage = false

[node name="plus_sound_button" type="Button" parent="VBoxContainer/SoundContainer"]
custom_minimum_size = Vector2(40, 34)
layout_mode = 2
size_flags_horizontal = 6
size_flags_vertical = 8
focus_mode = 0
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
theme_type_variation = &"small button"
text = "+"
icon_alignment = 1

[node name="blank" type="Control" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 40)
layout_mode = 2

[node name="close" type="Button" parent="VBoxContainer"]
custom_minimum_size = Vector2(160, 40)
layout_mode = 2
size_flags_horizontal = 4
focus_mode = 0
mouse_default_cursor_shape = 2
theme = ExtResource("1_7qeq7")
text = "BACK"

[connection signal="pressed" from="VBoxContainer/fullscreen_checkbutton" to="." method="_on_fullscreen_pressed"]
[connection signal="pressed" from="VBoxContainer/MusicContainer/minus_music_button" to="." method="_on_minus_music_button_pressed"]
[connection signal="pressed" from="VBoxContainer/MusicContainer/plus_music_button" to="." method="_on_plus_music_button_pressed"]
[connection signal="pressed" from="VBoxContainer/SoundContainer/minus_sound_button" to="." method="_on_minus_sound_button_pressed"]
[connection signal="pressed" from="VBoxContainer/SoundContainer/plus_sound_button" to="." method="_on_plus_sound_button_pressed"]
[connection signal="pressed" from="VBoxContainer/close" to="." method="_on_close_pressed"]
